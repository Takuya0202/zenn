---
title: "APIについて、理解を深める。"
emoji: "👋"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["api","webapi"]
published: false
---
# 初めに
今回は「web api the good parts」を読んでみて、理解したことについてまとめて行こうと思います。
https://www.oreilly.co.jp/books/9784873116860/

## 読もうとしたきっかけ
私は普段開発を中心に勉強をしており、これまで技術ブログなどの情報からなんとなくでAPIの開発など進めていたので、改めて深く学んでみたいと思い、本書を購入しました。

## そもそもwebAPIとは何なのか
そもそもよく耳にする**Web API**とは何なのだろうか？本書では以下のように記載されています。
> HTTPプロトコルを使用して、ネットワーク越しに呼び出すAPI。
  APIとは機能はわかってるけど、実際の動作の中身は詳しくわからない機能のカタマリを外部から呼び出すこと。
  プロトコルとして、HTTPを用い、そのエンドポイントはURLである。

つまりはURLにアクセスすることでJSONやXMLでレスポンスされるAPIのこと

## webAPIを公開する時に押さえておくこと
### そもそも何を公開すべきか
WebAPIを公開するとき、最も大事な点は**そのサービスが全てAPIを経由して行えるようにすること**です。
例として、ECサイトであれば商品の検索や情報の取得、購入、商品の購入履歴など
そのサービスが成立しうる上でコアとなる部分。そのサービスが価値を生み出している部分である。

### 公開する上でのリスク・メリット
サービスを公開するにあたって、そのサービスが集めた情報を盗まれてしまう
あるいは利益が損なわれてしまうと考えることもできるが、
自分たちで収集した情報や機能を提供することがそこまでリスクは大きくない。
また、レートリミットなどで無限にリクエストできるわけでもなく、
こちらのサービスに依存している以上、自身のサービスの利益が損なわれるようなことはない。
それらのデメリットよりも**自身のapiを利用して、第三者が自分の発想にはなかった新たな機能や価値を提供する**というメリットの方が大きい
もちろんスパムメッセージなど、自身のサイトの不利益につながる場合はAPI公開時に利用規約の設定などはすべき

### 美しいAPIの重要性
美しいAPI設計は以下のようなことが心掛けてある。
1. **使いやすさ**
  APIの利用するシーンにおいて、クライアントとサーバーサイドの開発者が異なるので、
  多くの立場の人に使いやすいAPIを公開するべき。
2. **変更しやすい**
  自身のサービスに関しては時間が経つにつれ、変化していくが、APIを利用している第三者にとって
  突然のAPIの仕様変更はサービスそのものが動かなくなってしまう恐れがあるため、
  APIの変化を利用者にとっていかに影響なく設計するかが大事
3. **頑強である**
  WebAPIは誰でも利用が可能であるため、セキュリティは考慮すべき。
4. **恥ずかしくない**
  Web APIは開発者が利用するため、開発者目線で美しいと思われるAPIを公開すべき。
  APIの設計が悪いというだけで、利用されない可能性もある。

## LSUDsとSSKDsについて
この本にはapiの設計ターゲットとして、以下の2種があると示されていました。
>**LSUDsとは**
  large set of unkonown developersのことで、
  twitterやfacebookのようにドキュメントを用意してあらゆるユーザーに向けたもの
  様々なユースケースを想定して、汎用的なAPI設計が必要

>**SSKDsとは**
  small set of known developersのことで、
  自社サービスのクライアント向けのAPIなど利用者が限られているもの。
  利用する開発者にとって便利なAPIの設計が必要。

## エンドポイント設計について
### エンドポイントの考え方
エンドポイント(URL)は**覚えやすく、どんな機能を持つURLなのかがわかること**が大事になってきます。
わかりやすいURLとは以下のようなことに気をつけられています。

### 短くて入力しやすいURL
以下のようなURLがあったとします。
`https://api.example.com/service/api/search`
`https://api.example.com/search`
前者は`api`という単語は重複していたり、`service`という概念のような単語が記載されているため、冗長になってしまっています。
`search`だけで検索関連のapiということはわかるので、なるべく短くします。

### 読んで理解できるURL
以下のようなURLがあったとします。
`https://api.example.com/sv/u`
`https://api.example.com/kensaku`
`https://api.example.com/find`
一つ目のURLは何の単語を指しているのかわからないため、よくありません。
二つ目に関しても日本語で書かれてしまうと、母国語ではない人にとってどんな意味か理解することができません。
単語としては英語もしくは国際規格で決まっているもの(日本 = jpなど)を採用します。
また、単に検索といっても`find`や`search`など、日本語に訳すと同じ意味の単語になってしまうものもありますが、ネイティブにとっては感覚が違うと思います。
他にも過去形などの時制であったり品詞、スペルミスなど小さなミスもあると思います。
一番の方法としては他のURLを見て、実際にどんな風に使われているか参考にすることです。

### 統一化されているURL
以下のようなURLがあったとします。
`https://api.example.com/posts?id=100`
`https://api.example.com/post/100/update`
両者とも投稿に関するapiですが、postとpostsになっていたり、投稿のidがクエリとパスで異なっています。
このようなURLだと、ミスにつながってしまうので、以下のように統一しましょう
`https://api.example.com/posts/100`
`https://api.example.com/posts/100/update`

### その他
他にも以下のようなことに気を付けられています
- 大文字と小文字が混在していないURL
- 改造しやすいURL
- サーバーの情報を含まないURL(URLに.phpなど技術要素を含んでいない)