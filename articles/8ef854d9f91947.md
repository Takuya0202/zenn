---
title: "[Next.js × hono × supabase]supabase-ssrを使ってバックエンドからユーザー認証する"
emoji: "🌊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [nextjs , hono , supabase , typescript , Oauth]
published: false
---
## 初めに
今回はhonoを使ってバックエンドからsupabaseのOAuth認証(google)を実装する方法について
まとめてみます。
認証についてバックエンドを経由することで、フロントエンドはUIに集中させ、バックエンドに
ロジックを任せることを目的としています。
### 実装する内容について
以下のような点を実装することをまとめてみます。
- googleでのユーザー登録、ログイン
- ユーザーの情報として、ユーザー名とアイコンを登録させる。

## どのように実装するのか？
実装方法について以下のようなフローを考えました。
```mermaid
sequenceDiagram
  participant F as frontend(Next.js)
  participant B as backend(Hono)
  participant SC as Supabase client
  participant Au as Supabase Auth
  participant O as Oauthプロバイダ(google)
  F->>B : GET /api/auth/google
  B->>SC : クライアントを作成
  SC->>Au : signInWithOAuth()を実行
  Au->>F : 302 Redirect Oauthのurlを返す
  F->>G : 認証を許可
  G->>B : GET /api/auth/callback
  B->>B : codeを取得
  B->>SC : クライアントを作成。
  SC->>Au : 
```