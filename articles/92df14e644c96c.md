---
title: "nextå¤šè¨€èªå¯¾å¿œã¾ã¨ã‚"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nextjs","ts","next-intl"]
published: false
---
# ç›®çš„
next.jsã§å¤šè¨€èªå¯¾å¿œã‚’å®Ÿè£…ã™ã‚‹ã€‚
å€‹äººçš„ã«ã¾ã¨ã‚ã¾ã™ã€‚
## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ
```
next-app/
â”œâ”€â”€ messages/                          # ç¿»è¨³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ en-US.json                     
â”‚   â”œâ”€â”€ ja-JP.json                    
â”‚   â”œâ”€â”€ ko-KR.json                     
â”‚   â”œâ”€â”€ zh-CN.json                     
â”‚   â””â”€â”€ zh-TW.json                     
â”œâ”€â”€ next.config.ts                     
â”œâ”€â”€ middleware.ts                      # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†
â”œâ”€â”€ i18n/                               
â”‚   â”œâ”€â”€ routing.ts                     # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
â”‚   â””â”€â”€ request.ts                     # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ã®å‡¦ç†
â””â”€â”€ app/
    â””â”€â”€ [lang]/                        # å‹•çš„ãƒ«ãƒ¼ãƒˆ ã“ã“ã«ã¯`en-US/ja-JP`ãªã©ãŒå…¥ã‚‹
        â”œâ”€â”€ layout.tsx                              
        â”œâ”€â”€ auth/
        â”‚   â”œâ”€â”€ login/
        â”‚   â”‚   â””â”€â”€ page.tsx
        â”‚   â””â”€â”€ register/
        â”‚       â””â”€â”€ page.tsx
        â””â”€â”€ profile/
            â””â”€â”€ page.tsx
```
## ãã‚‚ãã‚‚ã©ã†ã‚„ã£ã¦ã‚„ã‚‹ã®ã‹
### æµã‚Œ(ã‚„ã‚ŠãŸã„ã“ã¨)
1. è¨€èªåˆ¥ã«è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’`messages`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­ã«jsonã§ä¿å­˜ã™ã‚‹
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ`en-US/profile`ã®ã‚ˆã†ã«è¨€èªã¤ãã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹
3. urlã®ãƒ‘ã‚¹ã‹ã‚‰è¨€èªã‚’å–å¾—ã—ã€`message`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰`en-US.json`ã‚’å–å¾—ã™ã‚‹
4. å„ãƒšãƒ¼ã‚¸ã§jsonãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€è¡¨ç¤ºã™ã‚‹ã€‚

## å…·ä½“çš„ãªæµã‚Œ(å®Ÿéš›ã«ã©ã†ã‚„ã£ã¦ã„ãã‹)
1. `i18n/routing.ts`ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã‚’è¨˜è¼‰ã™ã‚‹ã€‚å¯¾å¿œè¨€èªã‚„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªãªã©ã€‚
2.  middleware.tsã«ã¦`ja-JP/profile`ã€`en-US/profile`ã®ã‚ˆã†ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã‚‹ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ã‹ã
3. `i18n/request.ts`ã«ã¦ã€urlã‹ã‚‰è¨€èªã‚’å–å¾—ã—ã€å¯¾å¿œã™ã‚‹jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®š
4. `layout.tsx`ã§`getMessages()`ã‚’å‘¼ã³å‡ºã—ã€jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã™ã‚‹ã€‚
5. å¯¾å¿œã™ã‚‹å„ãƒšãƒ¼ã‚¸ã«ãŠã„ã¦ã€SSRã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯`await getTranslations()`ã‚’ä½¿ç”¨ã—ã€CSRã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯`useTranslations`ã‚’ä½¿ç”¨ã™ã‚‹

## å®Ÿè£…ä¾‹
### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install next-intl
```

### è¨­å®š
#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å®šç¾©ã™ã‚‹
ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¾‹ã«å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
`messages/en-US.json`ã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ä½œæˆ
```json:messages/en-US.json
{
    "register": {
      "userName": "User name",
      "email": "email",
      "password": "password",
      "confirmPassword": "Confirm password",
      "userNamePlaceholder": "User name",
      "emailPlaceholder": "Email",
      "passwordPlaceholder": "Password",
      "confirmPasswordPlaceholder": "Confirm password"
    }
  }
```

#### next-configã®è¨­å®š
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹`i18n/request.ts`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½ç½®ã‚’è¨­å®šã—ã¾ã™ã€‚
`next.config.ts`ã®ä¸­ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½è¨˜
```ts:next.config.ts
import type { NextConfig } from "next";
import createNextIntlPlugin from "next-intl/plugin";

const nextConfig: NextConfig = {
  /* config options here */
};

const withNextIntl = createNextIntlPlugin(
  './i18n/request.ts' // ãƒ‘ã‚¹ã‚’æŒ‡å®š
);

export default withNextIntl(nextConfig);
```

### i18nã‚’å®šç¾©ã™ã‚‹
#### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®šç¾©
`i18n/routing.ts`ã«ä»¥ä¸‹ã®å†…å®¹ã‚’ä½œæˆã€‚
```ts:i18n/routing.ts
import { createNavigation } from "next-intl/navigation";
import { defineRouting } from "next-intl/routing";

export const routing = defineRouting({
  locales : ["en-US", "ko-KR", "zh-CN", "zh-TW", "ja-JP"], // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«å¯¾å¿œã™ã‚‹è¨€èª
  defaultLocale : "en-US",
})

// nextè£½ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã‚„ã‚ã¦ã€next-intlè£½ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚
export const {Link, redirect, usePathname, useRouter} = createNavigation(routing);
```
ã“ã“ã§ã¯å¯¾å¿œã™ã‚‹è¨€èªã‚„ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªãªã©ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã«ã¤ã„ã¦è¨­å®šã—ã¾ã™ã€‚
ã¾ãŸã€ä¸‹ã®è¡Œã§ã¯`Link`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãªã©ç”»é¢é·ç§»ã«é–¢ã‚ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¦ãŠã‚Šã€
ã“ã‚Œã«ã‚ˆã‚Š`locale`ã‚’è‡ªå‹•çš„ã«ä¿æŒã—ã¦ãã‚Œã¾ã™

ä¾‹ï¼š
```ts
// Next.jsã®redirect
import { redirect } from 'next/navigation';
redirect('/profile');
// â†’ /profile ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

// âœ… next-intlã®redirect
import { redirect } from '@/i18n/routing';
redirect('/profile');
// ç¾åœ¨ã®ãƒ­ã‚±ãƒ¼ãƒ«ãŒ en-US ã®å ´åˆ
// /en-US/profile ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
```

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å®šç¾©
å®Ÿéš›ã«`[lang]`ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ä¸ãˆã‚‰ã‚ŒãŸè¨€èªã‹ã‚‰å¯¾å¿œã™ã‚‹jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã™ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚
`i18n/request.ts`ã«ä»¥ä¸‹ã®å†…å®¹ã‚’ä½œæˆ
```ts:i18n/request.ts
import { getRequestConfig } from "next-intl/server";
import { hasLocale } from "next-intl";
import { routing } from "./routing";

export default getRequestConfig(async ({ requestLocale }) => {
  // en-USãªã©ã®[lang]éƒ¨åˆ†ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒå…¥ã‚‹
  const requested = await requestLocale;
  // ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹è¨€èªã‹ãƒã‚§ãƒƒã‚¯ã—ã€æœªå¯¾å¿œã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªã‚’ä½¿ç”¨
  const locale = hasLocale(routing.locales, requested) ? requested : routing.defaultLocale;

  return {
    locale,
    messages: (await import(`../messages/${locale}.json`)).default, // messageã¸ã®ãƒ‘ã‚¹
  };
});
```

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®š
æ¬¡ã«ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®šã‚’ã—ã¾ã™ã€‚